"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5283],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,i[1]=s;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),o=n(86010);const r={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(r.tabItem,i),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(87462),o=n(67294),r=n(86010),i=n(12466),s=n(16550),l=n(91980),u=n(67392),p=n(50012);function d(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:o}}=e;return{value:t,label:n,attributes:a,default:o}}))}function c(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??d(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,s.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,r=c(e),[i,s]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[l,u]=h({queryString:n,groupId:a}),[d,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,p.Nk)(n);return[a,(0,o.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:a}),k=(()=>{const e=l??d;return m({value:e,tabValues:r})?e:null})();(0,o.useLayoutEffect)((()=>{k&&s(k)}),[k]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),u(e),g(e)}),[u,g,r]),tabValues:r}}var k=n(72389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:n,selectedValue:s,selectValue:l,tabValues:u}=e;const p=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.o5)(),c=e=>{const t=e.currentTarget,n=p.indexOf(t),a=u[n].value;a!==s&&(d(t),l(a))},m=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:i}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>p.push(e),onKeyDown:m,onClick:c},i,{className:(0,r.Z)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":s===t})}),n??t)})))}function b(e){let{lazy:t,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function v(e){const t=g(e);return o.createElement("div",{className:(0,r.Z)("tabs-container",f.tabList)},o.createElement(y,(0,a.Z)({},e,t)),o.createElement(b,(0,a.Z)({},e,t)))}function w(e){const t=(0,k.Z)();return o.createElement(v,(0,a.Z)({key:String(t)},e))}},94304:(e,t,n)=>{n.d(t,{a:()=>r});var a=n(67294);const o="#f59e0b";function r(){return a.createElement("span",{style:{border:`2px solid ${o}`,display:"inline-block",padding:"0.2em 0.4em",color:o,borderRadius:"0.4em",fontSize:"0.8em",lineHeight:"1",fontWeight:"bold"}},"required")}},38919:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>c,default:()=>y,frontMatter:()=>d,metadata:()=>m,toc:()=>g});var a=n(87462),o=n(67294),r=n(3905),i=n(85162),s=n(74866);function l(){return o.createElement(o.Fragment,null,o.createElement("div",{className:"auth-methods-grid"},[{title:"Email",description:"Email verification, password reset, etc.",linkToDocs:"/docs/auth/email"},{title:"Username & Password",description:"The simplest way to get started",linkToDocs:"/docs/auth/username-and-pass"},{title:"Google",description:"Users sign in with their Google account",linkToDocs:"/docs/auth/social-auth/google"},{title:"Github",description:"Users sign in with their Github account",linkToDocs:"/docs/auth/social-auth/github"}].map((e=>o.createElement(u,{title:e.title,description:e.description,linkToDocs:e.linkToDocs})))),o.createElement("p",{className:"auth-methods-info"},o.createElement("small",null,"Click on each auth method for more details.")))}function u(e){let{linkToDocs:t,title:n,description:a}=e;return o.createElement("a",{href:t,className:"auth-method-box"},o.createElement("h3",null,n," \xbb"),o.createElement("p",null,a))}var p=n(94304);const d={title:"Using Auth"},c=void 0,m={unversionedId:"auth/overview",id:"auth/overview",title:"Using Auth",description:"Auth is an essential piece of any serious application. Coincidentally, Wasp provides authentication and authorization support out of the box \ud83d\ude43.",source:"@site/docs/auth/overview.md",sourceDirName:"auth",slug:"/auth/overview",permalink:"/docs/auth/overview",draft:!1,editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/docs/auth/overview.md",tags:[],version:"current",frontMatter:{title:"Using Auth"},sidebar:"docs",previous:{title:"Databases",permalink:"/docs/data-model/backends"},next:{title:"Auth UI",permalink:"/docs/auth/ui"}},h={},g=[{value:"Available auth methods",id:"available-auth-methods",level:2},{value:"Protecting a page with <code>authRequired</code>",id:"protecting-a-page-with-authrequired",level:2},{value:"Logout action",id:"logout-action",level:2},{value:"Accessing the logged-in user",id:"accessing-the-logged-in-user",level:2},{value:"On the client",id:"on-the-client",level:3},{value:"Using the <code>user</code> prop",id:"using-the-user-prop",level:4},{value:"Using the <code>useAuth</code> hook",id:"using-the-useauth-hook",level:4},{value:"On the server",id:"on-the-server",level:3},{value:"Using the <code>context.user</code> object",id:"using-the-contextuser-object",level:4},{value:"User entity",id:"user-entity",level:2},{value:"Password hashing",id:"password-hashing",level:3},{value:"Default validations",id:"default-validations",level:3},{value:"Username &amp; password",id:"username--password",level:4},{value:"Email",id:"email",level:4},{value:"Customizing validations",id:"customizing-validations",level:3},{value:"Validation Error Handling",id:"validation-error-handling",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"<code>userEntity: entity</code> <Required />",id:"userentity-entity-",level:4},{value:"<code>externalAuthEntity: entity</code>",id:"externalauthentity-entity",level:4},{value:"<code>methods: dict</code> <Required />",id:"methods-dict-",level:4},{value:"<code>onAuthFailedRedirectTo: String</code> <Required />",id:"onauthfailedredirectto-string-",level:4},{value:"<code>onAuthSucceededRedirectTo: String</code>",id:"onauthsucceededredirectto-string",level:4}],k={toc:g},f="wrapper";function y(e){let{components:t,...n}=e;return(0,r.kt)(f,(0,a.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Auth is an essential piece of any serious application. Coincidentally, Wasp provides authentication and authorization support out of the box \ud83d\ude43."),(0,r.kt)("p",null,"Enabling auth for your app is optional and can be done by configuring the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," field of the ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," declaration.  "),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app MyApp {\n  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    externalAuthEntity: SocialLogin,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute"\n  }\n}\n\n//...\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app MyApp {\n  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    externalAuthEntity: SocialLogin,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute"\n  }\n}\n\n//...\n')))),(0,r.kt)("small",null,(0,r.kt)("p",null,"  Read more about the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," field options in the ",(0,r.kt)("a",{parentName:"p",href:"#api-reference"},"API Reference")," section.")),(0,r.kt)("p",null,"We will provide a quick overview of auth in Wasp and link to more detailed documentation for each auth method."),(0,r.kt)("h2",{id:"available-auth-methods"},"Available auth methods"),(0,r.kt)("p",null,"Wasp supports the following auth methods:"),(0,r.kt)(l,{mdxType:"AuthMethodsGrid"}),(0,r.kt)("p",null,"Let's say we enabled the ",(0,r.kt)("a",{parentName:"p",href:"/docs/auth/username-and-pass"},"Username & password")," authentication."),(0,r.kt)("p",null,"We get an auth backend with signup and login endpoints. We also get the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object in our ",(0,r.kt)("a",{parentName:"p",href:"/docs/data-model/operations/overview"},"Operations")," and we can decide what to do based on whether the user is logged in or not. "),(0,r.kt)("p",null,"We would also get the ",(0,r.kt)("a",{parentName:"p",href:"/docs/auth/ui"},"Auth UI")," generated for us. We can set up our login and signup pages where our users can ",(0,r.kt)("strong",{parentName:"p"},"create their account")," and ",(0,r.kt)("strong",{parentName:"p"},"login"),". We can then protect certain pages by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired: true")," for them. This will make sure that only logged-in users can access them."),(0,r.kt)("p",null,"We will also have access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object in our frontend code, so we can show different UI to logged-in and logged-out users. For example, we can show the user's name in the header alongside a ",(0,r.kt)("strong",{parentName:"p"},"logout button")," or a login button if the user is not logged in."),(0,r.kt)("h2",{id:"protecting-a-page-with-authrequired"},"Protecting a page with ",(0,r.kt)("inlineCode",{parentName:"h2"},"authRequired")),(0,r.kt)("p",null,"When declaring a page, you can set the ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," property."),(0,r.kt)("p",null,"If you set it to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", only authenticated users can access the page. Unauthenticated users are redirected to a route defined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"app.auth.onAuthFailedRedirectTo")," field."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'page MainPage {\n  component: import Main from "@client/pages/Main.jsx",\n  authRequired: true\n}\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'page MainPage {\n  component: import Main from "@client/pages/Main.tsx",\n  authRequired: true\n}\n')))),(0,r.kt)("admonition",{title:"Requires auth method",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"You can only use ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," if your app uses one of the ",(0,r.kt)("a",{parentName:"p",href:"#available-auth-methods"},"available auth methods"),".")),(0,r.kt)("p",null,"If ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", the page's React component (specified by the ",(0,r.kt)("inlineCode",{parentName:"p"},"component")," property) receives the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object as a prop. Read more about the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object in the ",(0,r.kt)("a",{parentName:"p",href:"#accessing-the-logged-in-user"},"Accessing the logged-in user section"),"."),(0,r.kt)("h2",{id:"logout-action"},"Logout action"),(0,r.kt)("p",null,"We provide an action for logging out the user. Here's how you can use it:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="client/components/LogoutButton.jsx"',title:'"client/components/LogoutButton.jsx"'},"import logout from '@wasp/auth/logout'\n\nconst LogoutButton = () => {\n  return (\n    <button onClick={logout}>Logout</button>\n  )\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="client/components/LogoutButton.tsx"',title:'"client/components/LogoutButton.tsx"'},"import logout from '@wasp/auth/logout'\n\nconst LogoutButton = () => {\n  return (\n    <button onClick={logout}>Logout</button>\n  )\n}\n")))),(0,r.kt)("h2",{id:"accessing-the-logged-in-user"},"Accessing the logged-in user"),(0,r.kt)("p",null,"You can get access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object both in the backend and on the frontend."),(0,r.kt)("h3",{id:"on-the-client"},"On the client"),(0,r.kt)("p",null,"There are two ways to access the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object on the client:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("inlineCode",{parentName:"li"},"user")," prop "),(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("inlineCode",{parentName:"li"},"useAuth")," hook")),(0,r.kt)("h4",{id:"using-the-user-prop"},"Using the ",(0,r.kt)("inlineCode",{parentName:"h4"},"user")," prop"),(0,r.kt)("p",null,"If the page's declaration sets ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", the page's React component receives the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object as a prop:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\n\npage AccountPage {\n  component: import Account from "@client/pages/Account.jsx",\n  authRequired: true\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="client/pages/Account.jsx"',title:'"client/pages/Account.jsx"'},"import Button from './Button';\nimport logout from '@wasp/auth/logout';\n\nconst AccountPage = ({ user }) => {\n  return (\n    <div>\n      <Button onClick={logout}>Logout</Button>\n      {JSON.stringify(user, null, 2)}\n    </div>\n  );\n};\n\nexport default AccountPage;\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\n\npage AccountPage {\n  component: import Account from "@client/pages/Account.tsx",\n  authRequired: true\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="client/pages/Account.tsx"',title:'"client/pages/Account.tsx"'},"import type { User } from '@wasp/entities';\nimport Button from './Button';\nimport logout from '@wasp/auth/logout';\n\nconst AccountPage = ({ user }: { user: User }) => {\n  return (\n    <div>\n      <Button onClick={logout}>Logout</Button>\n      {JSON.stringify(user, null, 2)}\n    </div>\n  );\n};\n\nexport default AccountPage;\n")))),(0,r.kt)("h4",{id:"using-the-useauth-hook"},"Using the ",(0,r.kt)("inlineCode",{parentName:"h4"},"useAuth")," hook"),(0,r.kt)("p",null,"Wasp provides a React hook you can use in the client components - ",(0,r.kt)("inlineCode",{parentName:"p"},"useAuth"),"."),(0,r.kt)("p",null,"This hook is a thin wrapper over Wasp's ",(0,r.kt)("inlineCode",{parentName:"p"},"useQuery")," hook and returns data in the same format."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/client/pages/MainPage.jsx"',title:'"src/client/pages/MainPage.jsx"'},"import useAuth from '@wasp/auth/useAuth'\nimport { Link } from 'react-router-dom'\nimport logout from '@wasp/auth/logout'\nimport Todo from '../Todo'\n\nexport function Main() {\n  const { data: user } = useAuth()\n\n  if (!user) {\n    return (\n      <span>\n        Please <Link to='/login'>login</Link> or <Link to='/signup'>sign up</Link>.\n      </span>\n    )\n  } else {\n    return (\n      <>\n        <button onClick={logout}>Logout</button>\n        <Todo />\n      < />\n    )\n  }\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/client/pages/MainPage.tsx"',title:'"src/client/pages/MainPage.tsx"'},"import useAuth from '@wasp/auth/useAuth'\nimport { Link } from 'react-router-dom'\nimport logout from '@wasp/auth/logout'\nimport Todo from '../Todo'\n\nexport function Main() {\n  const { data: user } = useAuth()\n\n  if (!user) {\n    return (\n      <span>\n        Please <Link to='/login'>login</Link> or <Link to='/signup'>sign up</Link>.\n      </span>\n    )\n  } else {\n    return (\n      <>\n        <button onClick={logout}>Logout</button>\n        <Todo />\n      < />\n    )\n  }\n}\n")))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Since the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," prop is only available in a page's React component: use the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," prop in the page's React component and the ",(0,r.kt)("inlineCode",{parentName:"p"},"useAuth")," hook in any other React component.")),(0,r.kt)("h3",{id:"on-the-server"},"On the server"),(0,r.kt)("h4",{id:"using-the-contextuser-object"},"Using the ",(0,r.kt)("inlineCode",{parentName:"h4"},"context.user")," object"),(0,r.kt)("p",null,"When authentication is enabled, all ",(0,r.kt)("a",{parentName:"p",href:"/docs/data-model/operations/overview"},"queries and actions")," have access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object through the ",(0,r.kt)("inlineCode",{parentName:"p"},"context")," argument. ",(0,r.kt)("inlineCode",{parentName:"p"},"context.user")," contains all User entity's fields, except for the password."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/server/actions.js"',title:'"src/server/actions.js"'},"import HttpError from '@wasp/core/HttpError.js'\n\nexport const createTask = async (task, context) => {\n  if (!context.user) {\n    throw new HttpError(403)\n  }\n\n  const Task = context.entities.Task\n  return Task.create({\n    data: {\n      description: task.description,\n      user: {\n        connect: { id: context.user.id }\n      }\n    }\n  })\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/server/actions.ts"',title:'"src/server/actions.ts"'},'import type { Task } from "@wasp/entities"\nimport type { CreateTask } from "@wasp/actions/types"\nimport HttpError from \'@wasp/core/HttpError.js\'\n\ntype CreateTaskPayload = Pick<Task, "description">\n\nexport const createTask: CreateTask<CreateTaskPayload, Task> = async (args, context) => {\n  if (!context.user) {\n    throw new HttpError(403)\n  }\n\n  const Task = context.entities.Task\n  return Task.create({\n    data: {\n      description: args.description,\n      user: {\n        connect: { id: context.user.id }\n      }\n    }\n  })\n}\n')))),(0,r.kt)("p",null,"To implement access control in your app, each operation must check ",(0,r.kt)("inlineCode",{parentName:"p"},"context.user")," and decide what to do. For example, if ",(0,r.kt)("inlineCode",{parentName:"p"},"context.user")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," inside a private operation, the user's access should be denied."),(0,r.kt)("p",null,"When using WebSockets, the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object is also available on the ",(0,r.kt)("inlineCode",{parentName:"p"},"socket.data")," object. Read more in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/advanced/web-sockets#websocketfn-function"},"WebSockets section"),"."),(0,r.kt)("h2",{id:"user-entity"},"User entity"),(0,r.kt)("h3",{id:"password-hashing"},"Password hashing"),(0,r.kt)("p",null,"You don't need to worry about hashing the password yourself. Even when directly using the Prisma client and calling ",(0,r.kt)("inlineCode",{parentName:"p"},"create()")," with a plain-text password, Wasp's middleware makes sure to hash the password before storing it in the database.\nFor example, if you need to update a user's password, you can safely use the Prisma client to do so, e.g., inside an Action:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/server/actions.js"',title:'"src/server/actions.js"'},"export const updatePassword = async (args, context) => {\n  return context.entities.User.update({\n    where: { id: args.userId },\n    data: {\n      password: 'New pwd which will be hashed automatically!'\n    }\n  })\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/server/actions.ts"',title:'"src/server/actions.ts"'},'import type { UpdatePassword } from "@wasp/actions/types"\nimport type { User } from "@wasp/entities"\n\ntype UpdatePasswordPayload = {\n  userId: User["id"]\n}\n\nexport const updatePassword: UpdatePassword<UpdatePasswordPayload, User> = async (args, context) => {\n  return context.entities.User.update({\n    where: { id: args.userId },\n    data: {\n      password: \'New pwd which will be hashed automatically!\'\n    }\n  })\n}\n')))),(0,r.kt)("h3",{id:"default-validations"},"Default validations"),(0,r.kt)("p",null,"Wasp includes several basic validation mechanisms. If you need something extra, the ",(0,r.kt)("a",{parentName:"p",href:"#customizing-validations"},"next section")," shows how to customize them."),(0,r.kt)("p",null,"Default validations depend on the auth method you use."),(0,r.kt)("h4",{id:"username--password"},"Username & password"),(0,r.kt)("p",null,"If you use ",(0,r.kt)("a",{parentName:"p",href:"/docs/auth/username-and-pass"},"Username & password")," authentication, the default validations are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"username")," must not be empty"),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"password")," must not be empty, have at least 8 characters, and contain a number")),(0,r.kt)("p",null,"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"username"),"s are stored in a ",(0,r.kt)("strong",{parentName:"p"},"case-sensitive")," manner."),(0,r.kt)("h4",{id:"email"},"Email"),(0,r.kt)("p",null,"If you use ",(0,r.kt)("a",{parentName:"p",href:"/docs/auth/email"},"Email")," authentication, the default validations are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"email")," must not be empty and a valid email address"),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"password")," must not be empty, have at least 8 characters, and contain a number")),(0,r.kt)("p",null,"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"email"),"s are stored in a ",(0,r.kt)("strong",{parentName:"p"},"case-insensitive")," manner."),(0,r.kt)("h3",{id:"customizing-validations"},"Customizing validations"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"You can only disable the default validation for ",(0,r.kt)("strong",{parentName:"p"},"Username & password")," authentication, but you can add custom validations can to both ",(0,r.kt)("strong",{parentName:"p"},"Username & password")," and ",(0,r.kt)("strong",{parentName:"p"},"Email")," auth methods."),(0,r.kt)("p",{parentName:"admonition"},"This is a bug in Wasp that is being tracked ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/wasp-lang/wasp/issues/1358"},"here"))),(0,r.kt)("p",null,"To disable/enable default validations, or add your own, modify your custom signup function:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const newUser = context.entities.User.create({\n  data: {\n    username: args.username,\n    password: args.password // password hashed automatically by Wasp! \ud83d\udc1d\n  },\n  _waspSkipDefaultValidations: false, // can be omitted if false (default), or explicitly set to true\n  _waspCustomValidations: [\n    {\n      validates: 'password',\n      message: 'password must contain an uppercase letter',\n      validator: password => /[A-Z]/.test(password)\n    },\n  ]\n})\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const newUser = context.entities.User.create({\n  data: {\n    username: args.username,\n    password: args.password // password hashed automatically by Wasp! \ud83d\udc1d\n  },\n  _waspSkipDefaultValidations: false, // can be omitted if false (default), or explicitly set to true\n  _waspCustomValidations: [\n    {\n      validates: 'password',\n      message: 'password must contain an uppercase letter',\n      validator: password => /[A-Z]/.test(password)\n    },\n  ]\n})\n")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Validations always run on ",(0,r.kt)("inlineCode",{parentName:"p"},"create()"),".\nFor ",(0,r.kt)("inlineCode",{parentName:"p"},"update()"),", they only run when the field mentioned in ",(0,r.kt)("inlineCode",{parentName:"p"},"validates")," is present."),(0,r.kt)("p",{parentName:"admonition"},"The validation process stops on the first ",(0,r.kt)("inlineCode",{parentName:"p"},"validator")," to return false. If enabled, default validations run first and then custom validations.")),(0,r.kt)("h3",{id:"validation-error-handling"},"Validation Error Handling"),(0,r.kt)("p",null,"When creating, updating, or deleting entities, you may wish to handle validation errors. Wasp exposes a class called ",(0,r.kt)("inlineCode",{parentName:"p"},"AuthError")," for this purpose."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/server/actions.js"',title:'"src/server/actions.js"'},"try {\n  await context.entities.User.update(...)\n} catch (e) {\n  if (e instanceof AuthError) {\n    throw new HttpError(422, 'Validation failed', { message: e.message })\n  } else {\n    throw e\n  }\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/server/actions.ts"',title:'"src/server/actions.ts"'},"try {\n  await context.entities.User.update(...)\n} catch (e) {\n  if (e instanceof AuthError) {\n    throw new HttpError(422, 'Validation failed', { message: e.message })\n  } else {\n    throw e\n  }\n}\n")))),(0,r.kt)("h2",{id:"api-reference"},"API Reference"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    externalAuthEntity: SocialLogin,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute"\n  }\n}\n\n//...\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app MyApp {\n  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    externalAuthEntity: SocialLogin,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute"\n  }\n}\n\n//...\n')))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"app.auth")," is a dictionary with the following fields:"),(0,r.kt)("h4",{id:"userentity-entity-"},(0,r.kt)("inlineCode",{parentName:"h4"},"userEntity: entity")," ",(0,r.kt)(p.a,{mdxType:"Required"})),(0,r.kt)("p",null,"The entity representing the user. Its mandatory fields depend on your chosen auth method."),(0,r.kt)("h4",{id:"externalauthentity-entity"},(0,r.kt)("inlineCode",{parentName:"h4"},"externalAuthEntity: entity")),(0,r.kt)("p",null,"Wasp requires you to set the field ",(0,r.kt)("inlineCode",{parentName:"p"},"auth.externalAuthEntity")," for all authentication methods relying on an external authorizatino provider (e.g., Google). You also need to tweak the Entity referenced by ",(0,r.kt)("inlineCode",{parentName:"p"},"auth.userEntity"),", as shown below."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'{4,14} title="main.wasp"',"{4,14}":!0,title:'"main.wasp"'},"//...\n  auth: {\n    userEntity: User,\n    externalAuthEntity: SocialLogin,\n//...\n\nentity User {=psl\n    id                        Int           @id @default(autoincrement())\n    //...\n    externalAuthAssociations  SocialLogin[]\npsl=}\n\nentity SocialLogin {=psl\n  id          Int       @id @default(autoincrement())\n  provider    String\n  providerId  String\n  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)\n  userId      Int\n  createdAt   DateTime  @default(now())\n  @@unique([provider, providerId, userId])\npsl=}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'{4,14} title="main.wasp"',"{4,14}":!0,title:'"main.wasp"'},"//...\n  auth: {\n    userEntity: User,\n    externalAuthEntity: SocialLogin,\n//...\n\nentity User {=psl\n    id                        Int           @id @default(autoincrement())\n    //...\n    externalAuthAssociations  SocialLogin[]\npsl=}\n\nentity SocialLogin {=psl\n  id          Int       @id @default(autoincrement())\n  provider    String\n  providerId  String\n  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)\n  userId      Int\n  createdAt   DateTime  @default(now())\n  @@unique([provider, providerId, userId])\npsl=}\n")))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The same ",(0,r.kt)("inlineCode",{parentName:"p"},"externalAuthEntity")," can be used across different social login providers (e.g., both GitHub and Google can use the same entity).")),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/google"},"Google docs")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/auth/social-auth/github"},"GitHub docs")," for more details."),(0,r.kt)("h4",{id:"methods-dict-"},(0,r.kt)("inlineCode",{parentName:"h4"},"methods: dict")," ",(0,r.kt)(p.a,{mdxType:"Required"})),(0,r.kt)("p",null,"A dictionary of auth methods enabled for the app."),(0,r.kt)(l,{mdxType:"AuthMethodsGrid"}),(0,r.kt)("h4",{id:"onauthfailedredirectto-string-"},(0,r.kt)("inlineCode",{parentName:"h4"},"onAuthFailedRedirectTo: String")," ",(0,r.kt)(p.a,{mdxType:"Required"})),(0,r.kt)("p",null,"The route to which Wasp should redirect unauthenticated user when they try to access a private page (i.e., a page that has ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired: true"),").\nCheck out these ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorial/auth#adding-auth-to-the-project"},"essentials docs on auth")," to see an example of usage."),(0,r.kt)("h4",{id:"onauthsucceededredirectto-string"},(0,r.kt)("inlineCode",{parentName:"h4"},"onAuthSucceededRedirectTo: String")),(0,r.kt)("p",null,"The route to which Wasp will send a successfully authenticated after a successful login/signup.\nThe default value is ",(0,r.kt)("inlineCode",{parentName:"p"},'"/"'),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Automatic redirect on successful login only works when using the Wasp-provided ",(0,r.kt)("a",{parentName:"p",href:"/docs/auth/ui"},"Auth UI"),".")))}y.isMDXComponent=!0}}]);